<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">

<head>
	<meta charset="UTF-8">
	<title>Activity Information</title>
	<style>
		* {
			margin: 0;
			padding: 0;
			box-sizing: border-box;
		}

		/* Body styles */
		body {
			font-family: Arial, sans-serif;
			line-height: 1.6;
			background-color: #f5f5f5;
			overflow-x: hidden;
		}

		/* Header styles */
		header {
			background-color: #333;
			color: #fff;
			padding: 20px;
			text-align: center;
		}

		header h1 {
			font-size: 32px;
		}

		/* Search form styles */
		#search-form {
			margin-top: 20px;
		}

		#location-input {
			width: 300px;
			padding: 10px;
			border: none;
			border-radius: 5px;
			font-size: 16px;
		}

		.btn-primary {
			background-color: #007bff;
			color: #fff;
			padding: 10px 20px;
			border: none;
			border-radius: 5px;
			cursor: pointer;
		}

		/* Main section styles */
		main {
			display: flex;
			justify-content: space-between;
			padding: 20px;
		}

		.filter-container {
			flex: 0 0 25%;
			background-color: #f9f9f9;
			padding: 20px;
		}

		.filter {
			font-size: 28px;
			padding-bottom: 20px;
			margin-top: 20px;
			/* 这里是添加的上边距 */
		}

		.category-checkbox {
			margin-bottom: 10px;
		}

		#activities-section {
			flex: 0 0 75%;
			background-color: #fff;
			padding: 20px;
		}

		.activity {

			display: flex;
			border: 1px solid grey;
			border-radius: 20px;
			margin-bottom: 10px;
			height: 200px;
		}

		.activity img {
			width: 200px;
			max-height: 200px;
			object-fit: cover;
			margin-right: 20px;
			border-radius: 20px;
		}

		.activity-details {
			flex: 1;
		}

		.activity-details h3 {
			font-size: 32px;
			margin-bottom: 10px;
		}

		.activity-details p {
			font-size: 24px;
		}

		.book-btn {
			margin-top: 10px;

		}

		.price {
			position: relative;
			left: 920px;
			bottom: 180px;
			padding: 20px;
		}

		#validfrom-input {
			width: 150px;
			padding: 10px;
			border: none;
			border-radius: 5px;
			font-size: 16px;
		}

		#validto-input {
			width: 150px;
			padding: 10px;
			border: none;
			border-radius: 5px;
			font-size: 16px;
		}


		/* Footer styles */
		footer {
			background-color: #333;
			color: #fff;
			text-align: center;
			padding: 20px;
			margin-top: 20px;
		}

		footer p {
			font-size: 14px;
		}

		#add-to-favorites-btn {
			position: relative;
		}

		#add-to-favorites-btn::after {
			content: "加入收藏";
			position: absolute;
			top: -25px;
			/* 调整显示位置 */
			left: 50%;
			transform: translateX(-50%);
			background-color: rgba(0, 0, 0, 0.8);
			color: #fff;
			padding: 5px 10px;
			border-radius: 5px;
			opacity: 0;
			transition: opacity 0.3s ease;
		}

		#add-to-favorites-btn:hover::after {
			opacity: 1;

		}
	</style>
</head>


<body>

	<header>
		<h1>旅遊活動預訂<a th:href="@{/myFavoriteActivity}" class="btn btn-primary">我的行程</a></h1>

		<form id="search-form" th:action="@{/activityquerybylocationanddate}" method="get">
			<select id="location-input" name="locationName" placeholder="請選擇旅遊地點" required>
				<option value="">請選擇旅遊地點</option>
				<option value="1">台北市</option>
				<option value="2">新北市</option>
				<option value="3">桃園市</option>
				<option value="4">台中市</option>
				<option value="5">台南市</option>
				<option value="6">高雄市</option>
				<option value="7">基隆市</option>
				<option value="8">新竹市</option>
				<option value="9">嘉義市</option>
				<option value="10">新竹縣</option>
				<option value="11">苗栗縣</option>
				<option value="12">彰化縣</option>
				<option value="13">南投縣</option>
				<option value="14">雲林縣</option>
				<option value="15">嘉義縣</option>
				<option value="16">屏東縣</option>
				<option value="17">宜蘭縣</option>
				<option value="18">花蓮縣</option>
				<option value="19">台東縣</option>
				<option value="20">澎湖縣</option>
				<option value="21">金門縣</option>
				<option value="22">連江縣</option>
			</select>
			<!-- <form id="search-form" th:action="@{/activityquerybydate}" method="get"> -->
			<label for="validfrom-input">開始日期:</label>
			<input type="date" id="validfrom-input" name="validfrom" required>
			<label for="validto-input">結束日期:</label>
			<input type="date" id="validto-input" name="validto" required>
			<button type="submit" class="btn btn-primary">搜尋</button>
		</form>
	</header>

	<div id="result-count">&nbsp;</div>

	<main>
		<aside class="filter-container">
			<div class="filter-header"></div>
			<div class="filter">
				<h1>篩選條件</h1>
				<h3>活動類別</h3>
				<label><input type="checkbox" value="文化" class="category-checkbox"> 文化</label><br>
				<label><input type="checkbox" value="冒險" class="category-checkbox"> 冒險</label><br>
				<label><input type="checkbox" value="休閒" class="category-checkbox"> 休閒</label><br>
				<label><input type="checkbox" value="自然" class="category-checkbox"> 自然</label><br><br>
				<h3>價格</h3>
				<label><input type="checkbox" value="0~2000" class="price-checkbox"> 2000 TWD 以下</label><br>
				<label><input type="checkbox" value="2001~4000" class="price-checkbox"> 2001 TWD - 4000 TWD</label><br>
				<label><input type="checkbox" value="4001~6000" class="price-checkbox"> 4001 TWD - 6000 TWD</label><br>
				<label><input type="checkbox" value="6001~8000" class="price-checkbox"> 6001 TWD - 8000 TWD</label><br>
			</div>
		</aside>

		<div id="activities-section">
			<div th:if="${not #lists.isEmpty(activities)}">
				<div th:each="activity : ${activities}">
					<div class="activity">
						<img th:if="${activity.activityImages != null and not #lists.isEmpty(activity.activityImages)}"
							th:src="@{'picture/activity/' + ${activity.activityImages.get(0).imagepath}}" alt=""
							th:alt="${activity.tourName}" />
						<div class="activity-details">
							<h3 th:text="${activity.tourName}"></h3>
							<p th:text="${activity.tourDescription}"></p>
							<p th:text="${activity.tourCategory}"></p>
							<p th:text="${activity.validFrom}"></p>
							<p th:text="${activity.validTo}"></p>
							<div class="price">
								<p th:text="'價格TWD ' + ${activity.price}"></p>
								<form action="activityqueryfront" method="get">
									<input type="hidden" name="tourId" th:value="${activity.tourID}" />
									<button type="submit" class="book-btn btn btn-primary">查看詳細活動資訊</button>
								</form>
								<button class="btn btn-primary add-to-favorites-btn" 
								        th:attr="data-activityName=${activity.tourName}, 
								                 data-activityDescription=${activity.tourDescription}, 
								                 data-activityPrice=${activity.price},
								                 data-fullAddress=${activity.fullAddress},
								                 data-durationHours=${activity.durationhours}">加入我的行程</button>
							</div>
						</div>
					</div>
				</div>
			</div>
			<p th:if="${#lists.isEmpty(activities)}">無符合條件活動。</p>
		</div>

	</main>

	<footer>
		<p>&copy; 2024 旅遊活動預訂。保留所有權利。</p>
	</footer>

	<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

	<script th:inline="javascript">
		$(document).ready(function () {
		        $('#search-form').submit(function (event) {
		            event.preventDefault(); // 防止表單提交
		
		            // 獲取表單數據
		            var formData = {
		                location: $('#location-input').val(),
		                validfrom: $('#validfrom-input').val(),
		                validto: $('#validto-input').val()
		            };
		
		            // 使用 AJAX 發送 GET 請求
		            $.ajax({
		                type: 'GET',
		                url: '/activityquery1',
		                data: formData,
		                success: function (response) {
		                    // 處理成功響應，更新頁面的內容
		                    const tempDiv = document.createElement('div');
		                    tempDiv.innerHTML = response;
		
		                    // 從臨時div中找到活動部分的HTML內容
		                    const activitiesSectionHTML = tempDiv.querySelector('#activities-section').innerHTML;
		
		                    // 更新頁面中ID為activities-section的容器的HTML內容
		                    const activitiesSection = document.getElementById('activities-section');
		                    activitiesSection.innerHTML = ''; // 清空原先的內容
		                    activitiesSection.insertAdjacentHTML('beforeend', activitiesSectionHTML); // 插入新的活動內容
		
		                    // 更新資料筆數顯示
		                    const activitiesCount = tempDiv.querySelectorAll('.activity').length;
		                    const resultCountElement = document.getElementById('result-count');
		                    resultCountElement.innerText = "共" + activitiesCount + "筆資料";
		                },
		                error: function (xhr, status, error) {
		                    // 處理錯誤
		                    console.error(xhr.responseText);
		                }
		            });
		        });
		    });
	
			document.addEventListener("DOMContentLoaded", function () {
			    // 获取所有的价格范围核取方块
			    const priceCheckboxes = document.querySelectorAll('.price-checkbox');
			    // 获取所有的活动类别核取方块
			    const categoryCheckboxes = document.querySelectorAll('.category-checkbox');
			
			    function applyFilters() {
			        // 获取选中的价格范围和活动类别
			        const selectedPrices = Array.from(priceCheckboxes)
			            .filter(cb => cb.checked)
			            .map(cb => cb.value);
			        const selectedCategories = Array.from(categoryCheckboxes)
			            .filter(cb => cb.checked)
			            .map(cb => cb.value);
			
			        // 获取位置和日期参数
			        const location = $('#location-input').val();
			        const validfrom = $('#validfrom-input').val();
			        const validto = $('#validto-input').val();
			
			        // 更新 URL 中的搜索参数
			        const url = '/activityquery1?location=' + encodeURIComponent(location) +
			            '&validfrom=' + encodeURIComponent(validfrom) +
			            '&validto=' + encodeURIComponent(validto) +
			            '&prices=' + encodeURIComponent(selectedPrices.join(',')) +
			            '&tourCategories=' + encodeURIComponent(selectedCategories.join(','));
			
			        // 使用 AJAX 发送 GET 请求
			        $.ajax({
			            type: 'GET',
			            url: url,
			            success: function (response) {
			                // 处理成功响应，更新页面的内容
			                const tempDiv = document.createElement('div');
			                tempDiv.innerHTML = response;
			
			                // 从临时div中找到活动部分的HTML内容
			                const activitiesSectionHTML = tempDiv.querySelector('#activities-section').innerHTML;
			
			                // 更新页面中ID为activities-section的容器的HTML内容
			                const activitiesSection = document.getElementById('activities-section');
			                activitiesSection.innerHTML = ''; // 清空原先的内容
			                activitiesSection.insertAdjacentHTML('beforeend', activitiesSectionHTML); // 插入新的活动内容
			
			                // 更新数据笔数显示
			                const activitiesCount = tempDiv.querySelectorAll('.activity').length;
			                const resultCountElement = document.getElementById('result-count');
			                resultCountElement.innerText = "共" + activitiesCount + "筆資料";
			            },
			            error: function (xhr, status, error) {
			                // 处理错误
			                console.error(xhr.responseText);
			            }
			        });
			    }
			
			    // 监听价格范围核取方块的点击事件
			    priceCheckboxes.forEach(function (checkbox) {
			        checkbox.addEventListener('click', applyFilters);
			    });
			
			    // 监听活动类别核取方块的点击事件
			    categoryCheckboxes.forEach(function (checkbox) {
			        checkbox.addEventListener('click', applyFilters);
			    });
			});
	</script>



	<script th:inline="javascript">
		document.addEventListener("DOMContentLoaded", function () {
		    // 綁定事件到父元素
		    document.getElementById('activities-section').addEventListener('click', function (event) {
		        // 檢查點擊的元素是否是"加入收藏"按鈕
		        if (event.target.classList.contains('add-to-favorites-btn')) {
		            // 獲取當前活動的信息
		            const button = event.target;
		            const activityName = button.getAttribute('data-activityName');
		            const activityDescription = button.getAttribute('data-activityDescription');
		            const activityPrice = button.getAttribute('data-activityPrice');
		            const fullAddress = button.getAttribute('data-fullAddress');
		            const durationHours = button.getAttribute('data-durationHours'); // 獲取durationHours參數
		            console.log(fullAddress);
		            // 構造活動物件
		            const activity = {
		                name: activityName,
		                description: activityDescription,
		                price: activityPrice,
		                fullAddress: fullAddress,
		                durationHours: durationHours // 添加durationHours到活動物件
		            };
		
		            // 存儲活動信息到本地存儲中
		            let favoriteActivities = JSON.parse(localStorage.getItem('favoriteActivities')) || [];
		            favoriteActivities.push(activity);
		            localStorage.setItem('favoriteActivities', JSON.stringify(favoriteActivities));
		            // 提示使用者活動已收藏
		            alert('活動已成功收藏！');
		        }
		    });
		});
	</script>



</body>

</html>

